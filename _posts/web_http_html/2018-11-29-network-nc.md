---
layout: post
title: 网络端口监听 nc
category: network
comments: false
--- 

# 一、什么是nc
nc是netcat的简写，有着网络界的瑞士军刀美誉。因为它短小精悍、功能实用，被设计为一个简单、可靠的网络工具。

## 1.1 nc的作用

（1）实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口  
（2）端口的扫描，nc可以作为client发起TCP或UDP连接  
（3）机器之间传输文件  
（4）机器之间网络测速                                                                                                                                                                                                              
## 1.2 nc的控制参数
常用的几个参数如下所列：

1) -l  
用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。

2) -p <port>  
暂未用到（老版本的nc可能需要在端口号前加-p参数，下面测试环境是centos6.6，nc版本是nc-1.84，未用到-p参数）

3) -s   
指定发送数据的源IP地址，适用于多网卡机 

4) -u  
 指定nc使用UDP协议，默认为TCP

5) -v  
输出交互或出错信息，新手调试时尤为有用

6）-w  
超时秒数，后面跟数字 

7）-z  
表示zero，表示扫描时不发送任何数据

## 1.3 常见用法

### 1.3.1 网络连通性测试和端口扫描

nc可以作为server端启动一个tcp的监听（注意，此处重点是起tcp，下面还会讲udp）

先关闭A的防火墙，或者放行下面端口，然后测试B机器是否可以访问A机器启动的端口
在A机器上启动一个端口监听，比如 9999端口（注意：下面的-l 是小写的L，不是数字1）
默认情况下下面监听的是一个tcp的端口

	nc -l 9999

客户端测试连通性（这个可以用于很多场景）：

- 测试方法1: 在B机器上telnet A机器此端口，如下显示表示B机器可以访问A机器此端口`telnet ip port`
- 测试方法2: B机器上也可以使用nmap扫描A机器的此端口。`nmap 10.0.1.161 -p9999`
- 测试方法3: 使用nc命令作为客户端工具进行端口探测.`nc -vz -w 2 10.0.1.161 9999` 或 `nc -vzw 2 10.0.1.161 9999`（-v可视化，-z扫描时不发送数据，-w超时几秒，后面跟数字)

### 1.3.2 使用nc传输文件和目录

**方法1，传输文件演示（先启动接收命令）**

使用nc传输文件还是比较方便的，因为不用scp和rsync那种输入密码的操作了.

演练：把A机器上的一个rpm文件发送到B机器上。（需注意操作次序，receiver先侦听端口，sender向receiver所在机器的该端口发送数据。）
 
步骤1，先在B机器上启动一个接收文件的监听，格式如下：

	nc -l port >file

例如：
	
	nc -l 9995 >zabbix.rpm

意思是把来自9995端口接收到的数据都写到file文件里。（这里文件名随意取）

步骤2，在A机器上往B机器的9995端口发送数据，把下面rpm包发送过去：

	nc 10.0.1.162 9995 < zabbix-release-2.4-1.el6.noarch.rpm

机器接收完毕，它会自动退出监听，文件大小和A机器一样，md5值也一样。

----

**方法2，传输文件演示（先启动发送命令）**

步骤1，先在B机器上，启动发送文件命令

下面命令表示通过本地的9992端口发送test.mv文件：

	nc -l 9992 <test.mv

步骤2，A机器上连接B机器，取接收文件

下面命令表示通过连接B机器的9992端口接收文件，并把文件存到本目录下，文件名为test2.mv：

	nc 10.0.1.162 9992 >test2.mv

----

**方法3，传输目录演示（方法发送文件类似）**
 
步骤1，A机器给B机器发送多个文件，B机器先启动监听

注意传输目录需要结合其它的命令，比如tar。

经过我的测试管道后面最后必须是 - ，不能是其余自定义的文件名：

	nc -l 9995 | tar xfvz -

步骤2，A机器打包文件并连接B机器的端口  

管道前面表示把当前目录的所有文件打包为 - ，然后使用nc发送给B机器：

	tar cfz - * | nc 10.0.1.162 9995

B机器这边已经自动接收和解压。

### 1.3.3 测试网速

测试网速其实利用了传输文件的原理，就是把来自一台机器的/dev/zero 发送给另一台机器的/dev/null。
也就是把一台机器的无限个0，传输给另一个机器的空设备上，然后新开一个窗口使用dstat命令监测网速。

在这之前需要保证机器先安装dstat工具：

	yum install -y dstat
 
方法1，测试网速演示（先启动接收命令方式）

步骤1，A机器先启动接收数据的命令，监听自己的9991端口，把来自这个端口的数据都输出给空设备（这样不写磁盘，测试网速更准确）

	nc -l 9991 >/dev/null

步骤2，B机器发送数据，把无限个0发送给A机器的9991端口

	nc 10.0.1.161 9991 </dev/zero

在复制的窗口上使用dstat命令查看当前网速，dstat命令比较直观，它可以查看当前cpu、磁盘、网络和系统的一些当前状态指标。

看2列即可，recv是receive的缩写，表示接收的意思，send是发送数据，另外注意数字后面的单位B，KB，MB。

---- 

方法2类似，是先启动发送命令方式。不赘述。

# 二、坑

## 2.1 找不到命令

先安装nc和nmap的包

	yum install nc -y
	yum install nmap -y

# REF
> [nc命令用法举例](http://www.cnblogs.com/nmap/p/6148306.html)


